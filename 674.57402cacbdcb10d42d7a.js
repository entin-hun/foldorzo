(self.webpackChunk_converdy_website_builder=self.webpackChunk_converdy_website_builder||[]).push([[674],{674:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n});var r=i(2002);class s{constructor(){this.errors={}}get hasErrors(){return Object.keys(this.errors).length>0}clear(e){e?delete this.errors[e]:this.errors={}}push(e,t){return this.errors[e]||(this.errors[e]=[]),this.errors[e].push(t),this.errors}}const a={name:"CMultiStepForm",components:{BaseButton:r.A,CountrySelect:()=>Promise.all([i.e(864),i.e(370)]).then(i.bind(i,8370)),MultipleChoice:()=>i.e(58).then(i.bind(i,7058))},props:["properties"],data:()=>({fieldErrors:new s,isSubmitting:!1,activeStepIndex:0,userInput:{},showAfterSubmitMessage:!1}),inject:["funnelInfo"],created(){this.setInitialValue(),this.properties.cover&&this.properties.cover.enabled&&(this.activeStepIndex=-1)},mounted(){this.setInitialValue(),this.fillFields(),this.$replaceDynamicKeywords(this.$refs.form.$el)},watch:{activeStepIndex(){this.$nextTick((()=>{this.$replaceDynamicKeywords(this.$refs.form.$el),this.focustFirstField()}))}},methods:{handleUserInput(e,t){this.$set(this.userInput,e,t)},handleCheckboxClick(e,t){if(e.target.closest("a"))return!0;{const i=e.target.closest("label").querySelector("input"),r=Boolean(i.checked);this.userInput[t]=r,e.preventDefault()}},setInitialValue(){this.fields.forEach((e=>{this.userInput[e.id]="","checkbox"===e.type&&e.preChecked&&(this.userInput[e.id]=!0)}))},fillFields(){this.fields.forEach((e=>{"string"==typeof e.value&&(this.userInput[e.id]=this.$replaceDynamicKeywords(e.value))})),this.userInput=JSON.parse(JSON.stringify(this.userInput))},clearFieldError(e){this.fieldErrors.clear(e)},handleSubmit(){if(this.fieldErrors.clear(),this.activeStep.fields.map((e=>{const t=this.userInput[e.id];e.required&&function(e,t){return void 0===e||"string"==typeof e&&0===e.length||"checkbox"===t.type&&!1===e}(t,e)?this.fieldErrors.push(e.id,"This field is required"):"email"!==e.type||/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())||this.fieldErrors.push(e.id,"Enter a valid email")})),this.fieldErrors.hasErrors)window.setTimeout((()=>{try{this.$refs.fields.querySelector(".error input, .error [tabindex]").focus()}catch(e){console.log("Couldn't focus",e)}}),10);else if(this.activeStepIndex<this.steps.length-1)this.activeStepIndex++;else{const e={fields:this.fields.map((e=>(e.value=this.userInput[e.id],e))),project_id:this.funnelInfo.projectId,funnel_id:this.funnelInfo.funnelId,page_id:this.funnelInfo.pageId,form_id:this.properties.elementId,automations:this.automations},t=this.fields.reduce(((e,t)=>(e[t.id]=t.value,e)),{});if(console.log("data",e),window.__CONVERDY__.is_export){const i=e.fields;this.isSubmitting=!0,fetch(this.properties.webhookPostUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fieldsOld:i,...e,fields:t})}).then((e=>e.ok?null:e.text().then((t=>{throw new Error(`Webhook POST failed: ${e.status} ${t||e.statusText}`)})))).then((()=>{const e=this.properties.afterSubmitAction;if(e&&e.type){const{type:t,url:i,slug:r}=e,s=this.fields.reduce(((e,t)=>(e[t.id]=t.value,e)),{});this.isSubmitting=!1;try{window.formSubmitCallback&&window.formSubmitCallback(s)}catch(e){console.log("Error in formSubmitCallback for export:",e)}switch(t){case"external":location.href=this.$replaceDynamicKeywords(i);break;case"page":location.href=this.$replaceDynamicKeywords(r);break;default:this.properties.afterSubmitMessage&&(this.showAfterSubmitMessage=!0)}}else this.isSubmitting=!1,this.properties.afterSubmitMessage&&(this.showAfterSubmitMessage=!0),console.log("No afterSubmitAction defined for export, or action type missing.")})).catch((e=>{console.error("Error submitting form for export or in afterSubmitAction logic:",e),this.isSubmitting=!1}))}else this.isSubmitting=!0,fetch(`${window.__CONVERDY__.api_url}/public/form`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((i=>{this.isSubmitting=!1;const{pageId:r,elements:s,funnelId:a,projectId:n,slug:o}=window.__CONVERDY_LOCALIZED__,l=this.$getCookie("params",{});this.$setCookie("params",Object.assign({},l,t)),i.json().then((i=>{const{type:r,url:s,slug:a}=i;window.__CONVERDY__.createEvent({version:"1.1",scope:"form",name:"submitted",payload:{slug:window.__CONVERDY_VARIANT_TEST__SLUG||window.__CONVERDY_LOCALIZED__.slug,test:window.__CONVERDY_VARIANT_TEST__,email:e&&e.fields&&e.fields.find((e=>"email"==e.type))?e.fields.find((e=>"email"==e.type)).value:void 0}}).finally((()=>{try{window.formSubmitCallback&&window.formSubmitCallback(t)}catch(e){console.log(e)}switch(void 0!==window.gtag&&gtag("event","generate_lead"),r){case"external":location.href=this.$replaceDynamicKeywords(s);break;case"page":location.href=this.$replaceDynamicKeywords(a);break;default:this.properties.afterSubmitMessage&&(this.showAfterSubmitMessage=!0)}}))}))}))}},focustFirstField(){if(!this.$refs.fields)return;const e=this.$refs.fields.querySelector("input[type=email], input[type=text], input[type=number], textarea");e&&e.focus()}},computed:{errors(){return this.fieldErrors.errors},steps(){return this.properties.steps},activeStep(){return this.steps[this.activeStepIndex]},fields(){return 0===this.steps.length?[]:this.steps.map((e=>e.fields)).flat(1)},cover(){return this.properties.cover||{}}}};i(9825);const n=(0,i(7311).A)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("BaseEl",{ref:"form",staticClass:"hydrate",attrs:{properties:e.properties.base}},[e.showAfterSubmitMessage?i("div",[e._v("\n      "+e._s(e.properties.afterSubmitMessage)+"\n    ")]):e._e(),!e.showAfterSubmitMessage&&e.properties.initialized&&e.properties.steps&&e.properties.steps.length>0?i("form",{staticClass:"form",attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[i("div",{staticClass:"form-body"},[e.cover.enabled&&-1==e.activeStepIndex?i("div",{staticClass:"cover"},[i("div",{staticClass:"slot"},[e._t("content")],2),i("div",{staticClass:"step-button"},[e._v("\n            "+e._s(e.cover.buttonText)+"\n            "),i("BaseButton",{staticClass:"button",attrs:{type:"submit",properties:Object.assign({},e.properties.button,{text:e.cover.buttonText})}})],1)]):i("div",{ref:"fields",staticClass:"fields baseFields",class:[e.properties.baseFields.variant,"style-"+e.activeStep.style||0]},[e._l(e.activeStep.fields,(function(t){var r;return[i("div",{key:t.id,staticClass:"field",class:(r={error:e.errors[t.id]},r["type-"+t.type]=!0,r),attrs:{id:t.id}},[t.label?i("label",{staticClass:"label baseLabel",class:t.type,attrs:{id:t.id+"-label",for:t.id+"-input"}},[e._v("\n                "+e._s(t.label)+"\n              ")]):e._e(),"text"===t.type?[i("input",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.id],expression:"userInput[field.id]"}],staticClass:"input",attrs:{id:t.id+"-input",placeholder:t.placeholder,type:"text"},domProps:{value:e.userInput[t.id]},on:{input:[function(i){i.target.composing||e.$set(e.userInput,t.id,i.target.value)},function(i){return e.clearFieldError(t.id)}]}})]:e._e(),"date"===t.type?[i("input",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.name],expression:"userInput[field.name]"}],staticClass:"input",attrs:{id:t.id+"-input",placeholder:t.placeholder,type:"date"},domProps:{value:e.userInput[t.name]},on:{input:[function(i){i.target.composing||e.$set(e.userInput,t.name,i.target.value)},function(i){return e.clearFieldError(t.id)}]}})]:e._e(),"hidden"===t.type?[i("input",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.id],expression:"userInput[field.id]"}],staticClass:"input",attrs:{id:t.id+"-input",type:"hidden"},domProps:{value:e.userInput[t.id]},on:{input:[function(i){i.target.composing||e.$set(e.userInput,t.id,i.target.value)},function(i){return e.clearFieldError(t.id)}]}})]:"email"===t.type?[i("input",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.id],expression:"userInput[field.id]"}],staticClass:"input",attrs:{id:t.id+"-input",placeholder:t.placeholder,type:"email"},domProps:{value:e.userInput[t.id]},on:{input:[function(i){i.target.composing||e.$set(e.userInput,t.id,i.target.value)},function(i){return e.clearFieldError(t.id)}]}})]:"dropdown"===t.type?[i("div",{staticClass:"select-field"},[i("select",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.id],expression:"userInput[field.id]"}],staticClass:"input",on:{change:function(i){var r=Array.prototype.filter.call(i.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.userInput,t.id,i.target.multiple?r:r[0])}}},e._l(t.options||[],(function(t){return i("option",{key:t.id,attrs:{disabled:t.disabled},domProps:{value:t.title}},[e._v("\n                      "+e._s(t.title)+"\n                    ")])})),0)])]:"country"===t.type?i("CountrySelect",{attrs:{field:t},model:{value:e.userInput[t.id],callback:function(i){e.$set(e.userInput,t.id,i)},expression:"userInput[field.id]"}}):"multiple-choice"===t.type?i("MultipleChoice",{attrs:{field:t,handleUserInput:e.handleUserInput,userInput:e.userInput},model:{value:e.userInput[t.id],callback:function(i){e.$set(e.userInput,t.id,i)},expression:"userInput[field.id]"}}):"tel"===t.type?[i("input",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.id],expression:"userInput[field.id]"}],staticClass:"input",attrs:{id:t.id+"-input",placeholder:t.placeholder,type:"tel"},domProps:{value:e.userInput[t.id]},on:{input:[function(i){i.target.composing||e.$set(e.userInput,t.id,i.target.value)},function(i){return e.clearFieldError(t.id)}]}})]:"textarea"===t.type?[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.id],expression:"userInput[field.id]"}],staticClass:"input textarea",attrs:{id:t.id+"-input",placeholder:t.placeholder},domProps:{value:e.userInput[t.id]},on:{input:[function(i){i.target.composing||e.$set(e.userInput,t.id,i.target.value)},function(i){return e.clearFieldError(t.id)}]}})]:"checkbox"===t.type?[i("label",{staticClass:"checkbox-wrapper no-dki",attrs:{for:t.id+"-input"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.userInput[t.id],expression:"userInput[field.id]"}],attrs:{type:"checkbox",id:t.id+"-input"},domProps:{checked:Array.isArray(e.userInput[t.id])?e._i(e.userInput[t.id],null)>-1:e.userInput[t.id]},on:{input:function(i){return e.handleCheckboxClick(arguments[0],t.id)},change:function(i){var r=e.userInput[t.id],s=i.target,a=!!s.checked;if(Array.isArray(r)){var n=e._i(r,null);s.checked?n<0&&e.$set(e.userInput,t.id,r.concat([null])):n>-1&&e.$set(e.userInput,t.id,r.slice(0,n).concat(r.slice(n+1)))}else e.$set(e.userInput,t.id,a)}}}),i("div",{staticClass:"description ml-3",domProps:{innerHTML:e._s(t.description)}})])]:e._e(),e.errors[t.id]?[i("span",{staticClass:"error-message"},[e._v("\n                  "+e._s(e.errors[t.id].join(", "))+"\n                ")])]:e._e()],2)]})),i("div",{staticClass:"step-button"},[i("BaseButton",{staticClass:"button no-dki",attrs:{loading:e.isSubmitting,type:"submit",textProps:{class:"no-dki"},properties:Object.assign({},e.properties.button,{text:e.activeStep.buttonText})}})],1)],2)])]):e._e()])}),[],!1,null,"1da4ef12",null).exports},8287:(e,t,i)=>{(t=i(5077)(!1)).push([e.id,".type-hidden[data-v-1da4ef12],.field.hidden[data-v-1da4ef12]{display:none}.fields[data-v-1da4ef12]{display:flex;flex-wrap:wrap}.step-button[data-v-1da4ef12]{width:100%}.input[data-v-1da4ef12]{width:100%;display:block}.text-card-grid[data-v-1da4ef12]{margin-top:8px;display:grid;grid-gap:8px;grid-template-columns:1fr 1fr 1fr}.text-card[data-v-1da4ef12]{padding:16px;border-radius:8px;color:#bbb;border:2px solid #bbb;cursor:pointer}.text-card.selected[data-v-1da4ef12]{color:var(--color-primary);border:2px solid var(--color-primary)}.text-card-title[data-v-1da4ef12]{margin-bottom:8px}.text-card-description[data-v-1da4ef12]{font-size:.8em}.checkbox-wrapper[data-v-1da4ef12]{display:flex;align-items:center;margin-bottom:16px}.checkbox-wrapper input[data-v-1da4ef12]{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:0;-webkit-print-color-adjust:exact;color-adjust:exact;display:inline-block;vertical-align:middle;background-origin:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;flex-shrink:0;height:1rem;width:1rem;color:#2563eb;background-color:#fff;border-color:#6b7280;border-width:1px}.checkbox-wrapper input[type=radio][data-v-1da4ef12]{border-radius:100%}.checkbox-wrapper input[type=radio][data-v-1da4ef12]:checked{background-color:var(--color-primary);background-image:url(\"data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e\")}.checkbox-wrapper input[type=checkbox][data-v-1da4ef12]{border-radius:100%;border-radius:.25rem}.checkbox-wrapper input[type=checkbox][data-v-1da4ef12]:checked{background-color:var(--color-primary);background-image:url(\"data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e\")}@media(min-width: 769px){.fields.style-horizontal[data-v-1da4ef12]{flex-wrap:nowrap}.fields.style-horizontal.baseFields .field[data-v-1da4ef12]{display:flex;flex-direction:column;justify-content:flex-end}.fields.style-horizontal.baseFields .input[data-v-1da4ef12]{margin-bottom:0px;height:3rem !important}.fields.style-horizontal .step-button[data-v-1da4ef12]{display:flex;align-items:flex-end;width:auto;flex-shrink:0}.fields.style-horizontal .step-button button[data-v-1da4ef12]{margin-bottom:0px;display:flex;justify-content:center;height:3rem !important}}",""]),e.exports=t},9825:(e,t,i)=>{var r=i(8287);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,i(8665).A)("420c4a5c",r,!0,{})}}]);