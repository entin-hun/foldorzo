(self.webpackChunk_converdy_website_builder=self.webpackChunk_converdy_website_builder||[]).push([[349,880],{1349:()=>{},1440:(e,t,r)=>{(t=r(5077)(!1)).push([e.id,".upsell__text-container[data-v-a0e0732a]{margin-bottom:30px}.upsell__button-container[data-v-a0e0732a]{margin-bottom:1em}",""]),e.exports=t},3967:(e,t,r)=>{var n=r(6481);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),(0,r(8665).A)("66c75839",n,!0,{})},6290:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(2002);const o={props:{properties:Object,paymentIntegrations:Object,value:Object},computed:{stripeSupportsCard(){return this.paymentIntegrations.stripe&&this.paymentIntegrations.stripe.payment_method_types.includes("card")},stripeSupportsIdeal(){return this.paymentIntegrations.stripe&&this.paymentIntegrations.stripe.payment_method_types.includes("ideal")},isStripeCardSelected(){const{payment_processor:e,payment_method_type:t}=this.value;return"stripe"===e&&"card"===t},isStripeIdealSelected(){const{payment_processor:e,payment_method_type:t}=this.value;return"stripe"===e&&"ideal"===t}},mounted(){window.focus(),window.addEventListener("blur",this.paymentStarted),this.$emit("change",{processor:this.properties.preferredPaymentProcessor,type:this.properties.preferredPaymentMethod})},beforeDestroy(){window.removeEventListener("blur",this.paymentStarted)},methods:{paymentStarted(){const e=document.querySelectorAll(".checkout-payment-fields iframe");let t=!1;for(let r=0;r<e.length;r++)e[r]==document.activeElement&&(t=!0);t&&window.removeEventListener("blur",this.paymentStarted)},addPaymentInfoEvent(){window.__CONVERDY__.createEvent({scope:"checkout",name:"AddPaymentInfo"})},async handleStripeInput(e){const{value:t}=e.target;this.$emit("change",{processor:"stripe",type:t})}}};r(3967);var i=r(7311);const s=(0,i.A)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.paymentIntegrations?r("div",{staticClass:"checkout-payment-options"},[r("label",{staticClass:"baseLabel"},[e._v("Payment Method")]),r("div",{staticClass:"payment-options"},[e.paymentIntegrations.stripe?r("div",{staticClass:"payment-options-stripe"},[e.stripeSupportsCard?r("label",{staticClass:"payment-option",class:{active:e.isStripeCardSelected},attrs:{for:"paymentOptionStripeCard"}},[r("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{id:"paymentOptionStripeCard",type:"radio",value:"card",name:"paymentOption"},domProps:{checked:e.isStripeCardSelected},on:{input:e.handleStripeInput}}),r("div",[e._v("Credit Card")])]):e._e(),e.stripeSupportsIdeal?r("label",{staticClass:"payment-option",class:{active:e.isStripeIdealSelected},attrs:{for:"paymentOptionStripeIdeal"}},[r("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{id:"paymentOptionStripeIdeal",type:"radio",value:"ideal",name:"paymentOption"},domProps:{checked:e.isStripeIdealSelected},on:{input:e.handleStripeInput}}),r("div",[e._v("iDeal")])]):e._e()]):e._e()])]):e._e()}),[],!1,null,"54faacd2",null).exports;var a=r(399);const p={components:{PaymentOptions:s,BaseButton:n.A},props:{storeConfig:Object,invoiceId:String,buttonProperties:Object,redirectUrl:String},data:()=>({paymentProcessor:"",paymentMethodType:void 0,paymentInProgress:!1,stripe:{card:{element:null},ideal:{element:null}}}),computed:{paymentOption(){return{payment_processor:this.paymentProcessor,payment_method_type:this.paymentMethodType}},paymentIntegrations(){return this.storeConfig.paymentProcessors},payInvoiceDto(){return{invoice_id:this.invoiceId,payment_info:{payment_processor:this.paymentProcessor,payment_method_type:this.paymentMethodType}}}},methods:{handlePaymentOptionChange({processor:e,type:t}){this.paymentProcessor=e,this.paymentMethodType=t},handleStripeElementChange(e){console.log(e)},async handleConfirmButtonClicked(){try{const e=await a.A.payInvoice(this.payInvoiceDto);this.handlePayInvoiceResponse(e)}catch(e){console.log(e)}},async handlePayInvoiceResponse(e){e.completed?this.$emit("success"):e.payment_info.payment_processor}}};r(9497);const c=(0,i.A)(p,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("PaymentOptions",{attrs:{"payment-integrations":e.paymentIntegrations,value:e.paymentOption},on:{change:e.handlePaymentOptionChange}}),r("div",{staticClass:"c-upsell__pay-invoice__button-container"},[r("BaseButton",{staticClass:"button",attrs:{type:"submit",loading:e.paymentInProgress,properties:e.buttonProperties},nativeOn:{click:function(t){return e.handleConfirmButtonClicked.apply(null,arguments)}}},[e._v("\n      Confirm\n    ")])],1)],1)}),[],!1,null,null,null).exports;var l=r(4583),d=r.n(l),m=r(0),u=r(373);const y={name:"CUpsell",components:{BaseButton:n.A,PayInvoice:c},props:{properties:{type:Object}},data:()=>({orderInProgress:!1,paymentIntegration:null,storeConfig:{sellerCountry:"",paymentProcessors:{stripe:{}}},orderSecret:"",showPayInvoiceInterface:!1,invoiceId:null,upsellOrderSecret:""}),computed:{isPreviewer:()=>"undefined"!=typeof window&&"previewer"===window.__CONVERDY_ENV__,projectId(){return m.HN.bind(this)()},isUpsellPossible(){return this.orderSecret},confirmRedirectUrl(){return(0,m.hr)(this.properties.confirmAction,window.__CONVERDY_LOCALIZED__.pages)},fullConfirmRedirectUrl(){return(0,m.Z2)(this.confirmRedirectUrl,this.upsellOrderSecret)},declineRedirectUrl(){return`${(0,m.hr)(this.properties.declineAction,window.__CONVERDY_LOCALIZED__.pages)}?order_secret=${this.orderSecret}`},orderItemDto(){const{productId:e,pricingOptionId:t}=this.properties.product;return{product_id:e,pricing_option_id:t}},upsellDto(){return{order_secret:this.orderSecret,items:[{...this.orderItemDto}]}}},mounted(){this.checkUpsellArgs(),this.fetchStoreConfig()},methods:{checkUpsellArgs(){this.orderSecret=(0,u.Ri)("c-prev-order_secret")||new URLSearchParams(window.location.search).get("order_secret")},async fetchStoreConfig(){const e=await a.A.fetchStoreConfig(this.projectId);this.storeConfig.sellerCountry=e.seller_country;const t=(await a.A.fetchPaymentIntegrationId(this.orderSecret)).id;this.paymentIntegration=e.payment_integrations.find((e=>e._id==t))},async handleConfirmClick(){if(this.isPreviewer)return;const e=window.location.href.substring(0,window.location.href.lastIndexOf("."))+window.location.href.substring(window.location.href.lastIndexOf(".")).split("/")[0],t=-1==this.confirmRedirectUrl.indexOf("http")?e+"/"+this.confirmRedirectUrl:this.confirmRedirectUrl,r=await d()({scope:"pay",paymentIntegration:this.paymentIntegration,data:{...this.upsellDto,project_id:this.paymentIntegration.projectId,redirectUrl:t,url:window.location.href}});console.log(r)},handleDeclineClick(){this.isPreviewer||window.location.assign(this.declineRedirectUrl)},handleInvoicePaymentSuccess(e){return window.location.assign((0,m.Z2)(this.confirmRedirectUrl,orderResponse.order_secret))}}};r(6870);const h=(0,i.A)(y,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("BaseEl",{staticClass:"wrapper",staticStyle:{"text-align":"center"}},[e.$isServer?e._e():[e.isUpsellPossible||e.isPreviewer?[r("div",{staticClass:"upsell__button-container"},[r("BaseButton",{staticClass:"button confirm-button",attrs:{loading:e.orderInProgress,type:"submit",properties:Object.assign({},e.properties.confirmButton)},nativeOn:{click:function(t){return e.handleConfirmClick.apply(null,arguments)}}})],1),r("div",{staticClass:"upsell__button-container"},[r("BaseButton",{staticClass:"button decline-button",attrs:{properties:Object.assign({},e.properties.declineButton)},nativeOn:{click:function(t){return e.handleDeclineClick.apply(null,arguments)}}})],1)]:[e._v("\n      Missing details on the original order. Upsell not possible.\n    ")],e.showPayInvoiceInterface?r("PayInvoice",{attrs:{"invoice-id":e.invoiceId,"store-config":e.storeConfig,"button-properties":e.properties.payInvoiceButton,"redirect-url":e.fullConfirmRedirectUrl},on:{success:e.handleInvoicePaymentSuccess}}):e._e()]],2)}),[],!1,null,"a0e0732a",null).exports},6481:(e,t,r)=>{(t=r(5077)(!1)).push([e.id,".checkout-payment-options[data-v-54faacd2]{margin-bottom:20px}.payment-options-stripe[data-v-54faacd2]{display:grid;grid-auto-flow:column;grid-gap:15px}.payment-options-stripe .payment-option[data-v-54faacd2]{padding:20px;background-color:#fff;border-radius:var(--themeShape);border:var(--themeBorderThickness) solid var(--color-greyDefault);cursor:pointer}.payment-options-stripe .payment-option div[data-v-54faacd2]{display:flex;align-items:center;justify-content:center;color:var(--color-primary)}.payment-options-stripe .payment-option i[data-v-54faacd2]{margin-right:15px;color:var(--color-primary);font-size:24px}.payment-options-stripe .payment-option.active[data-v-54faacd2]{color:var(--color-primary);border-color:var(--color-primary)}.payment-options-stripe .payment-option.active div[data-v-54faacd2],.payment-options-stripe .payment-option.active i[data-v-54faacd2]{color:var(--color-primary)}",""]),e.exports=t},6870:(e,t,r)=>{var n=r(1440);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),(0,r(8665).A)("a77be7e4",n,!0,{})},7979:(e,t,r)=>{(t=r(5077)(!1)).push([e.id,".c-upsell__pay-invoice__button-container{margin-top:15px}",""]),e.exports=t},9497:(e,t,r)=>{var n=r(7979);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),(0,r(8665).A)("14f5b498",n,!0,{})}}]);